<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be My Valentine?</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #0066ff;
            --secondary: #ff0000;
            --accent: #ffd93d;
            --bg: #0a0a1a;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: white;
            min-height: 100vh;
            overflow: hidden;
        }
        
        /* Cursor Trail */
        .trail {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            font-size: 14px;
            animation: fade 0.6s forwards;
        }
        
        @keyframes fade {
            to { opacity: 0; transform: scale(0.5); }
        }
        
        /* Loading */
        .loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }
        
        .loader.hidden { opacity: 0; pointer-events: none; }
        
        .loader-heart { font-size: 4rem; animation: pulse 1s infinite; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* Main Container */
        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0,102,255,0.15), transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(255,0,0,0.15), transparent 50%);
        }
        
        /* 3D Heart */
        .heart-wrap {
            width: 300px;
            height: 300px;
            position: relative;
            margin-bottom: 2rem;
        }
        
        .orbit {
            position: absolute;
            top: 50%; left: 50%;
            width: 280px; height: 280px;
            transform: translate(-50%, -50%);
            animation: spin 15s linear infinite;
        }
        
        @keyframes spin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .orbit span {
            position: absolute;
            font-size: 20px;
            font-weight: bold;
            color: var(--accent);
        }
        
        .heart-center {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 150px; height: 150px;
            animation: beat 1.5s ease-in-out infinite;
        }
        
        @keyframes beat {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }
        
        .heart-center svg {
            width: 100%; height: 100%;
            filter: drop-shadow(0 0 20px rgba(0,102,255,0.5));
        }
        
        .heart-text {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 3px;
        }
        
        /* Question Box */
        .question-box {
            text-align: center;
            padding: 2rem;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 10;
        }
        
        .question-box h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .question-box p {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 2rem;
        }
        
        /* Buttons */
        .buttons {
            display: flex;
            gap: 2rem;
            justify-content: center;
        }
        
        .btn {
            padding: 1.2rem 3rem;
            font-size: 1.3rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-yes {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 10px 30px rgba(0,102,255,0.4);
        }
        
        .btn-yes:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(0,102,255,0.6);
        }
        
        /* NO Button - Calm Escape */
        .btn-no {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            position: relative;
        }
        
        .btn-no.dodging {
            position: fixed !important;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        /* Popup */
        .popup {
            position: fixed;
            background: rgba(255,0,0,0.9);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            font-weight: bold;
            pointer-events: none;
            z-index: 10000;
            animation: pop 1.5s forwards;
        }
        
        @keyframes pop {
            0% { opacity: 0; transform: scale(0.8); }
            20% { opacity: 1; transform: scale(1); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translateY(-30px); }
        }
        
        /* Confetti */
        canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        
        @media (max-width: 600px) {
            .question-box h1 { font-size: 2rem; }
            .buttons { flex-direction: column; }
            .heart-wrap { width: 250px; height: 250px; }
        }
    </style>
</head>
<body>
    <div class="loader" id="loader">
        <div class="loader-heart">üíô‚ô•Ô∏è</div>
    </div>
    
    <canvas id="confetti"></canvas>
    
    <div class="container">
        <div class="heart-wrap">
            <div class="orbit" id="orbit"></div>
            <div class="heart-center">
                <svg viewBox="0 0 100 100">
                    <defs>
                        <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#0066ff"/>
                            <stop offset="100%" stop-color="#ff0000"/>
                        </linearGradient>
                    </defs>
                    <path d="M50,85 C50,85 15,55 15,35 C15,20 25,10 40,10 C47,10 50,15 50,20 C50,15 53,10 60,10 C75,10 85,20 85,35 C85,55 50,85 50,85 Z" 
                          fill="url(#grad)"/>
                </svg>
            </div>
            <div class="heart-text" id="orbitText">FOREVER</div>
        </div>
        
        <div class="question-box">
            <h1 id="mainQuestion">Will You Be My Valentine?</h1>
            <p id="subMessage">My heart has been waiting for this moment...</p>
            
            <div class="buttons">
                <button class="btn btn-yes" id="yesBtn">YES! üíô‚ô•Ô∏è</button>
                <button class="btn btn-no" id="noBtn">No...</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDsqaoDlN8-XyHCsGrhaHQkMQBiEwmgk8o",
            authDomain: "vibez-7c71e.firebaseapp.com",
            projectId: "vibez-7c71e",
            storageBucket: "vibez-7c71e.firebasestorage.app",
            messagingSenderId: "544032234117",
            appId: "1:544032234117:web:9200a924e920c99221e7ec",
            measurementId: "G-DQ4GMVLTL7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let data = {
            mainQuestion: 'Will You Be My Valentine?',
            subMessage: 'My heart has been waiting for this moment...',
            yesText: 'YES! üíô‚ô•Ô∏è',
            noText: 'No...',
            orbitText: 'FOREVER'
        };
        
        const messages = ["No... üíî", "Think again... ü§î", "Wrong! ‚ùå", "Try YES üòâ", "Please? ü•∫", "I'm out üèÉ"];
        let msgIndex = 0;
        
        // Trail
        document.addEventListener('mousemove', (e) => {
            if (Math.random() > 0.9) {
                const t = document.createElement('div');
                t.className = 'trail';
                t.textContent = ['üíô', '‚ô•Ô∏è', '‚ú®'][Math.floor(Math.random() * 3)];
                t.style.left = e.clientX + 'px';
                t.style.top = e.clientY + 'px';
                t.style.color = Math.random() > 0.5 ? '#0066ff' : '#ff0000';
                document.body.appendChild(t);
                setTimeout(() => t.remove(), 600);
            }
        });
        
        // Load data
        async function load() {
            try {
                const snap = await getDoc(doc(db, 'site', 'data'));
                if (snap.exists()) data = { ...data, ...snap.data() };
            } catch (e) {
                const local = localStorage.getItem('valentineData');
                if (local) data = { ...data, ...JSON.parse(local) };
            }
            
            update();
            setTimeout(() => document.getElementById('loader').classList.add('hidden'), 1000);
        }
        
        function update() {
            document.getElementById('mainQuestion').textContent = data.mainQuestion;
            document.getElementById('subMessage').textContent = data.subMessage;
            document.getElementById('yesBtn').textContent = data.yesText;
            document.getElementById('noBtn').textContent = data.noText;
            document.getElementById('orbitText').textContent = data.orbitText;
            
            // Setup orbit text
            const orbit = document.getElementById('orbit');
            orbit.innerHTML = '';
            const chars = data.orbitText.split('');
            chars.forEach((c, i) => {
                const s = document.createElement('span');
                s.textContent = c;
                const ang = (i / chars.length) * Math.PI * 2;
                s.style.left = Math.cos(ang) * 130 + 130 + 'px';
                s.style.top = Math.sin(ang) * 130 + 130 + 'px';
                s.style.color = i % 2 ? '#ff0000' : '#0066ff';
                orbit.appendChild(s);
            });
        }
        
        // YES button
        document.getElementById('yesBtn').addEventListener('click', () => {
            confetti();
            localStorage.setItem('valentineSaidYes', 'true');
            setTimeout(() => window.location.href = 'timer.html', 1500);
        });
        
        // NO button - calm escape
        const noBtn = document.getElementById('noBtn');
        let escaping = false;
        
        document.addEventListener('mousemove', (e) => {
            if (escaping) return;
            const r = noBtn.getBoundingClientRect();
            const cx = r.left + r.width/2, cy = r.top + r.height/2;
            const dist = Math.sqrt((e.clientX-cx)**2 + (e.clientY-cy)**2);
            
            if (dist < 150) {
                escaping = true;
                noBtn.classList.add('dodging');
                
                // Change text
                if (msgIndex < messages.length) noBtn.textContent = messages[msgIndex++];
                
                // Teleport away from YES button
                const yesR = document.getElementById('yesBtn').getBoundingClientRect();
                const yesX = yesR.left + yesR.width/2, yesY = yesR.top + yesR.height/2;
                
                let nx, ny, d;
                do {
                    nx = Math.random() * (window.innerWidth - 150) + 50;
                    ny = Math.random() * (window.innerHeight - 80) + 50;
                    d = Math.sqrt((nx-yesX)**2 + (ny-yesY)**2);
                } while (d < 200);
                
                noBtn.style.left = nx + 'px';
                noBtn.style.top = ny + 'px';
                
                setTimeout(() => escaping = false, 300);
            }
        });
        
        noBtn.addEventListener('click', (e) => {
            const p = document.createElement('div');
            p.className = 'popup';
            p.textContent = "Nice try! Click YES üíô";
            p.style.left = e.clientX + 'px';
            p.style.top = e.clientY + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 1500);
        });
        
        function confetti() {
            const c = document.getElementById('confetti');
            const x = c.getContext('2d');
            c.width = window.innerWidth;
            c.height = window.innerHeight;
            
            const parts = [];
            for (let i = 0; i < 100; i++) {
                parts.push({
                    x: c.width/2, y: c.height/2,
                    vx: (Math.random()-0.5)*20, vy: (Math.random()-0.5)*20-5,
                    s: Math.random()*8+4, c: ['#0066ff','#ff0000','#ffd93d'][Math.floor(Math.random()*3)],
                    l: 1
                });
            }
            
            function anim() {
                x.clearRect(0,0,c.width,c.height);
                let alive = false;
                parts.forEach(p => {
                    if (p.l <= 0) return;
                    alive = true;
                    p.x += p.vx; p.y += p.vy; p.vy += 0.3; p.l -= 0.02;
                    x.globalAlpha = p.l;
                    x.fillStyle = p.c;
                    x.beginPath();
                    x.arc(p.x, p.y, p.s, 0, Math.PI*2);
                    x.fill();
                });
                if (alive) requestAnimationFrame(anim);
            }
            anim();
        }
        
        load();
    </script>
</body>
</html>
