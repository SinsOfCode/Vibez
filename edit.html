<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Site</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --blue: #0066ff;
            --red: #ff0000;
            --accent: #ffd93d;
            --bg: #0a0a1a;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: white;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(255,255,255,0.03);
            border-right: 1px solid rgba(255,255,255,0.1);
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .logo {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--blue), var(--red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
        }
        
        .nav-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.7);
            text-align: left;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .nav-btn:hover, .nav-btn.active {
            background: linear-gradient(135deg, rgba(0,102,255,0.2), rgba(255,0,0,0.2));
            color: white;
        }
        
        .save-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .btn-save {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--blue), var(--red));
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,102,255,0.4);
        }
        
        .btn-secondary {
            width: 100%;
            padding: 0.7rem;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .btn-danger {
            color: var(--red);
            border-color: var(--red);
        }
        
        .btn-danger:hover {
            background: rgba(255,0,0,0.1);
        }
        
        .status {
            font-size: 0.85rem;
            opacity: 0.6;
            margin-top: 0.5rem;
            text-align: center;
        }
        
        .status.synced {
            color: #00ff00;
        }
        
        .status.error {
            color: #ff4444;
        }
        
        /* Main Content */
        .main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--blue), var(--red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .preview-link {
            color: var(--blue);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border: 1px solid var(--blue);
            border-radius: 20px;
            transition: all 0.3s;
        }
        
        .preview-link:hover {
            background: var(--blue);
            color: white;
        }
        
        /* Sections */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Form Styles */
        .form-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .form-card h3 {
            background: linear-gradient(135deg, var(--blue), var(--red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 0.8rem;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            margin-bottom: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 10px rgba(0,102,255,0.3);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .color-input {
            height: 50px;
            cursor: pointer;
            padding: 0.2rem;
        }
        
        /* Slides List */
        .slide-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .slide-item:hover {
            background: rgba(255,255,255,0.08);
            border-color: var(--blue);
        }
        
        .slide-num {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--blue), var(--red));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .slide-info {
            flex: 1;
        }
        
        .slide-title-small {
            font-weight: 600;
            margin-bottom: 0.2rem;
        }
        
        .slide-preview {
            font-size: 0.85rem;
            opacity: 0.6;
        }
        
        .btn-add {
            width: 100%;
            padding: 1rem;
            background: transparent;
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }
        
        .btn-add:hover {
            border-color: var(--blue);
            color: var(--blue);
        }
        
        /* Slide Editor */
        .slide-editor {
            background: rgba(0,0,0,0.3);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
            border: 1px solid rgba(0,102,255,0.3);
        }
        
        .editor-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .editor-actions button {
            flex: 1;
            padding: 0.8rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-confirm {
            background: linear-gradient(135deg, var(--blue), var(--red));
            color: white;
        }
        
        .btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,102,255,0.4);
        }
        
        .btn-cancel {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
        }
        
        .btn-cancel:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .btn-delete {
            background: rgba(255,0,0,0.2);
            color: var(--red);
            border: 1px solid var(--red);
        }
        
        .btn-delete:hover {
            background: rgba(255,0,0,0.3);
        }
        
        /* Theme Presets */
        .presets {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .preset {
            height: 60px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            color: white;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            transition: all 0.3s;
        }
        
        .preset:hover {
            transform: scale(1.05);
        }
        
        /* Image Preview */
        #imagePreview {
            max-width: 200px;
            border-radius: 10px;
            margin: 1rem 0;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .image-note {
            font-size: 0.8rem;
            color: #ffc107;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">üíô‚ô•Ô∏è EDITOR</div>
            
            <button class="nav-btn active" onclick="showSection('general')">‚öô General</button>
            <button class="nav-btn" onclick="showSection('landing')">üè† Landing Page</button>
            <button class="nav-btn" onclick="showSection('timer')">‚è± Timer</button>
            <button class="nav-btn" onclick="showSection('slides')">üìñ Story Slides</button>
            <button class="nav-btn" onclick="showSection('letter')">üíå Love Letter</button>
            <button class="nav-btn" onclick="showSection('theme')">üé® Theme</button>
            
            <div class="save-section">
                <button class="btn-save" onclick="saveToFirebase()">üíæ SAVE TO CLOUD</button>
                <button class="btn-secondary" onclick="exportData()">üì§ Export JSON</button>
                <button class="btn-secondary" onclick="importData()">üì• Import JSON</button>
                <button class="btn-secondary btn-danger" onclick="resetAll()">‚Ü∫ Reset All</button>
                <div class="status" id="status">Click SAVE TO CLOUD when ready</div>
            </div>
            
            <a href="index.html" style="display:block;margin-top:2rem;color:var(--blue);text-decoration:none;text-align:center;font-weight:600;">‚Üê View Site</a>
        </div>
        
        <!-- Main -->
        <div class="main">
            <div class="header">
                <h1 id="sectionTitle">General Settings</h1>
                <a href="index.html" class="preview-link" target="_blank">Preview ‚Üí</a>
            </div>
            
            <!-- GENERAL -->
            <div class="section active" id="section-general">
                <div class="form-card">
                    <h3>Site Information</h3>
                    <label>Site Title (browser tab)</label>
                    <input type="text" id="siteTitle">
                    
                    <label>Your Name</label>
                    <input type="text" id="yourName">
                    
                    <label>Partner's Name</label>
                    <input type="text" id="partnerName">
                </div>
            </div>
            
            <!-- LANDING -->
            <div class="section" id="section-landing">
                <div class="form-card">
                    <h3>Main Question</h3>
                    <label>The Big Question</label>
                    <input type="text" id="mainQuestion">
                    
                    <label>Subtitle Message</label>
                    <input type="text" id="subMessage">
                    
                    <label>Yes Button Text</label>
                    <input type="text" id="yesText">
                    
                    <label>No Button Text</label>
                    <input type="text" id="noText">
                    
                    <label>Heart Text (center of spinning heart)</label>
                    <input type="text" id="orbitText">
                </div>
                
                <div class="form-card">
                    <h3>Success Page</h3>
                    <label>Success Message</label>
                    <input type="text" id="successMsg">
                    
                    <label>Timer Label</label>
                    <input type="text" id="timerLabel">
                </div>
            </div>
            
            <!-- TIMER -->
            <div class="section" id="section-timer">
                <div class="form-card">
                    <h3>Relationship Start Date</h3>
                    <label>When did you start dating? (for the counter)</label>
                    <input type="datetime-local" id="startDate">
                    
                    <p style="margin-top:1rem;opacity:0.7;font-size:0.9rem;">
                        This date is used to calculate how long you've been together on the timer page.
                    </p>
                </div>
            </div>
            
            <!-- SLIDES -->
            <div class="section" id="section-slides">
                <div class="form-card">
                    <h3>Story Slides</h3>
                    <button class="btn-add" onclick="addSlide()">+ Add New Slide</button>
                    
                    <div id="slidesList"></div>
                    
                    <!-- Slide Editor -->
                    <div class="slide-editor" id="slideEditor" style="display:none;">
                        <h4 style="margin-bottom:1rem;color:var(--accent);">Edit Slide <span id="editingNum">1</span></h4>
                        
                        <label>Slide Title</label>
                        <input type="text" id="editSlideTitle">
                        
                        <label>Slide Content</label>
                        <textarea id="editSlideContent" rows="4"></textarea>
                        
                        <label>Date (optional)</label>
                        <input type="date" id="editSlideDate">
                        
                        <label>Background Color</label>
                        <input type="color" id="editSlideColor" class="color-input">
                        
                        <label>Image (optional)</label>
                        <input type="file" accept="image/*" id="editSlideImage" onchange="handleImage(this)">
                        <p class="image-note">‚ö†Ô∏è Images stored locally only</p>
                        <img id="imagePreview" style="display:none;">
                        
                        <div class="editor-actions">
                            <button class="btn-confirm" onclick="saveSlide()">üíæ Save Slide</button>
                            <button class="btn-cancel" onclick="closeEditor()">Cancel</button>
                            <button class="btn-delete" onclick="deleteSlide()">üóë Delete</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- LETTER -->
            <div class="section" id="section-letter">
                <div class="form-card">
                    <h3>Final Love Letter</h3>
                    <label>Letter Title</label>
                    <input type="text" id="letterTitle">
                    
                    <label>Letter Content (use new lines for paragraphs)</label>
                    <textarea id="letterContent" rows="10"></textarea>
                    
                    <label>Sign-off</label>
                    <input type="text" id="letterSign">
                    
                    <p style="margin-top:1rem;opacity:0.7;font-size:0.9rem;">
                        This appears when she clicks the sealed letter at the end of the story.
                    </p>
                </div>
            </div>
            
            <!-- THEME -->
            <div class="section" id="section-theme">
                <div class="form-card">
                    <h3>Quick Color Presets</h3>
                    <div class="presets">
                        <button class="preset" onclick="applyPreset('romantic')" style="background:linear-gradient(135deg,#0066ff,#ff0000)">Blue/Red</button>
                        <button class="preset" onclick="applyPreset('ocean')" style="background:linear-gradient(135deg,#667eea,#764ba2)">Ocean</button>
                        <button class="preset" onclick="applyPreset('sunset')" style="background:linear-gradient(135deg,#f093fb,#f5576c)">Sunset</button>
                        <button class="preset" onclick="applyPreset('forest')" style="background:linear-gradient(135deg,#11998e,#38ef7d)">Forest</button>
                        <button class="preset" onclick="applyPreset('gold')" style="background:linear-gradient(135deg,#f5af19,#f12711)">Gold</button>
                        <button class="preset" onclick="applyPreset('midnight')" style="background:linear-gradient(135deg,#232526,#414345)">Midnight</button>
                    </div>
                    
                    <h3>Custom Colors</h3>
                    <label>Primary Color (Blue default)</label>
                    <input type="color" id="primaryColor" class="color-input">
                    
                    <label>Secondary Color (Red default)</label>
                    <input type="color" id="secondaryColor" class="color-input">
                    
                    <label>Accent Color (Yellow default)</label>
                    <input type="color" id="accentColor" class="color-input">
                    
                    <label>Background Color</label>
                    <input type="color" id="bgColor" class="color-input">
                </div>
            </div>
            
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDsqaoDlN8-XyHCsGrhaHQkMQBiEwmgk8o",
            authDomain: "vibez-7c71e.firebaseapp.com",
            projectId: "vibez-7c71e",
            storageBucket: "vibez-7c71e.firebasestorage.app",
            messagingSenderId: "544032234117",
            appId: "1:544032234117:web:9200a924e920c99221e7ec",
            measurementId: "G-DQ4GMVLTL7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // DEFAULT DATA
        const defaultData = {
            siteTitle: "Our Love Story",
            yourName: "You",
            partnerName: "Her",
            mainQuestion: "Will You Be My Valentine?",
            subMessage: "My heart has been waiting for this moment...",
            yesText: "YES! üíô‚ô•Ô∏è",
            noText: "No...",
            orbitText: "FOREVER",
            successMsg: "You Made Me The Happiest Person Alive!",
            timerLabel: "Together For",
            startDate: "2024-02-14T00:00",
            slides: [
                { title: "Our First Meeting", content: "The day that changed everything...", date: "2024-02-14", color: "#0066ff", image: null },
                { title: "Our First Date", content: "I knew you were special from the start.", date: "", color: "#ff0000", image: null },
                { title: "Countless Memories", content: "Every moment with you is a treasure.", date: "", color: "#0066ff", image: null }
            ],
            letterTitle: "My Dearest Love",
            letterContent: "From the moment I met you, my world changed forever.\n\nYou bring joy to every day and love to every moment.\n\nI am so grateful to have you in my life.\n\nHappy Valentine's Day, my love.\n\nForever and always.",
            letterSign: "Forever Yours",
            colors: {
                primary: "#0066ff",
                secondary: "#ff0000",
                accent: "#ffd93d",
                bg: "#0a0a1a"
            }
        };
        
        // State
        let data = JSON.parse(JSON.stringify(defaultData));
        let editingIndex = null;
        let isSyncing = false;
        
        // Initialize
        async function init() {
            showStatus('Loading...');
            
            try {
                const docRef = doc(db, 'site', 'data');
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    // Merge cloud data with defaults
                    const cloudData = docSnap.data();
                    data = { ...defaultData, ...cloudData };
                    
                    // Restore images from local if cloud doesn't have them
                    const local = localStorage.getItem('valentineData');
                    if (local) {
                        const localData = JSON.parse(local);
                        if (localData.slides && data.slides) {
                            data.slides = data.slides.map((slide, i) => ({
                                ...slide,
                                image: localData.slides[i]?.image || null
                            }));
                        }
                    }
                    
                    showStatus('Synced from cloud ‚úì', 'synced');
                } else {
                    // Create default document
                    await setDoc(docRef, data);
                    showStatus('Created new site ‚úì', 'synced');
                }
                
                // Save to local
                localStorage.setItem('valentineData', JSON.stringify(data));
                
                // Real-time listener
                onSnapshot(docRef, (doc) => {
                    if (doc.exists() && !isSyncing) {
                        const cloudData = doc.data();
                        data = { ...data, ...cloudData };
                        fillAllFields();
                        renderSlides();
                        showStatus('Live update received ‚úì', 'synced');
                    }
                });
                
            } catch (e) {
                console.error('Firebase error:', e);
                // Fallback to local
                const local = localStorage.getItem('valentineData');
                if (local) {
                    try {
                        data = JSON.parse(local);
                        showStatus('Offline mode (local data)', 'error');
                    } catch (err) {
                        data = JSON.parse(JSON.stringify(defaultData));
                        showStatus('Using defaults', 'error');
                    }
                } else {
                    showStatus('Offline mode (defaults)', 'error');
                }
            }
            
            fillAllFields();
            renderSlides();
        }
        
        // Fill all form fields
        function fillAllFields() {
            // General
            document.getElementById('siteTitle').value = data.siteTitle || '';
            document.getElementById('yourName').value = data.yourName || '';
            document.getElementById('partnerName').value = data.partnerName || '';
            
            // Landing
            document.getElementById('mainQuestion').value = data.mainQuestion || '';
            document.getElementById('subMessage').value = data.subMessage || '';
            document.getElementById('yesText').value = data.yesText || '';
            document.getElementById('noText').value = data.noText || '';
            document.getElementById('orbitText').value = data.orbitText || '';
            document.getElementById('successMsg').value = data.successMsg || '';
            document.getElementById('timerLabel').value = data.timerLabel || '';
            
            // Timer
            document.getElementById('startDate').value = data.startDate || '';
            
            // Letter
            document.getElementById('letterTitle').value = data.letterTitle || '';
            document.getElementById('letterContent').value = data.letterContent || '';
            document.getElementById('letterSign').value = data.letterSign || '';
            
            // Colors
            document.getElementById('primaryColor').value = data.colors?.primary || '#0066ff';
            document.getElementById('secondaryColor').value = data.colors?.secondary || '#ff0000';
            document.getElementById('accentColor').value = data.colors?.accent || '#ffd93d';
            document.getElementById('bgColor').value = data.colors?.bg || '#0a0a1a';
        }
        
        // Read current form values into data object
        function readFormData() {
            data.siteTitle = document.getElementById('siteTitle').value;
            data.yourName = document.getElementById('yourName').value;
            data.partnerName = document.getElementById('partnerName').value;
            data.mainQuestion = document.getElementById('mainQuestion').value;
            data.subMessage = document.getElementById('subMessage').value;
            data.yesText = document.getElementById('yesText').value;
            data.noText = document.getElementById('noText').value;
            data.orbitText = document.getElementById('orbitText').value;
            data.successMsg = document.getElementById('successMsg').value;
            data.timerLabel = document.getElementById('timerLabel').value;
            data.startDate = document.getElementById('startDate').value;
            data.letterTitle = document.getElementById('letterTitle').value;
            data.letterContent = document.getElementById('letterContent').value;
            data.letterSign = document.getElementById('letterSign').value;
            
            if (!data.colors) data.colors = {};
            data.colors.primary = document.getElementById('primaryColor').value;
            data.colors.secondary = document.getElementById('secondaryColor').value;
            data.colors.accent = document.getElementById('accentColor').value;
            data.colors.bg = document.getElementById('bgColor').value;
        }
        
        // Navigation
        window.showSection = function(name) {
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(name) || 
                    (name === 'general' && btn.textContent.includes('General')) ||
                    (name === 'landing' && btn.textContent.includes('Landing')) ||
                    (name === 'timer' && btn.textContent.includes('Timer')) ||
                    (name === 'slides' && btn.textContent.includes('Slides')) ||
                    (name === 'letter' && btn.textContent.includes('Letter')) ||
                    (name === 'theme' && btn.textContent.includes('Theme'))) {
                    btn.classList.add('active');
                }
            });
            
            // Show correct section
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + name).classList.add('active');
            
            // Update title
            const titles = {
                general: 'General Settings',
                landing: 'Landing Page',
                timer: 'Love Timer',
                slides: 'Story Slides',
                letter: 'Love Letter',
                theme: 'Theme & Colors'
            };
            document.getElementById('sectionTitle').textContent = titles[name] || 'Settings';
        };
        
        // Save to Firebase
        window.saveToFirebase = async function() {
            readFormData();
            
            showStatus('Saving...');
            isSyncing = true;
            
            try {
                // Save text data to Firebase (without images to avoid size limits)
                const cloudData = {
                    ...data,
                    slides: data.slides.map(s => ({ ...s, image: null }))
                };
                
                await setDoc(doc(db, 'site', 'data'), cloudData);
                
                // Save full data (with images) to localStorage
                localStorage.setItem('valentineData', JSON.stringify(data));
                
                showStatus('‚úì SAVED TO CLOUD!', 'synced');
                
                setTimeout(() => {
                    isSyncing = false;
                }, 1000);
                
            } catch (e) {
                console.error('Save failed:', e);
                showStatus('Save failed - check console', 'error');
                isSyncing = false;
            }
        };
        
        // Export/Import
        window.exportData = function() {
            readFormData();
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `valentine-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus('Exported ‚úì', 'synced');
        };
        
        window.importData = function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        data = { ...defaultData, ...imported };
                        fillAllFields();
                        renderSlides();
                        showStatus('Imported! Click SAVE TO CLOUD');
                    } catch (err) {
                        alert('Invalid JSON file!');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        };
        
        window.resetAll = function() {
            if (!confirm('RESET EVERYTHING to defaults? This cannot be undone!')) return;
            data = JSON.parse(JSON.stringify(defaultData));
            fillAllFields();
            renderSlides();
            showStatus('Reset - click SAVE TO CLOUD to apply');
        };
        
        // Slides
        window.renderSlides = function() {
            const container = document.getElementById('slidesList');
            if (!container) return;
            
            if (!data.slides || data.slides.length === 0) {
                container.innerHTML = '<p style="opacity:0.6;text-align:center;padding:2rem;">No slides yet. Click "Add New Slide" to start!</p>';
                return;
            }
            
            container.innerHTML = data.slides.map((slide, i) => `
                <div class="slide-item" onclick="editSlide(${i})">
                    <div class="slide-num" style="background:linear-gradient(135deg,${slide.color || '#0066ff'},${data.colors?.secondary || '#ff0000'});">${i+1}</div>
                    <div class="slide-info">
                        <div class="slide-title-small">${slide.title || 'Untitled'}</div>
                        <div class="slide-preview">${(slide.content || '').substring(0,50)}...</div>
                        ${slide.image ? '<span style="color:#ffd93d;font-size:0.75rem;">üì∑ Has image</span>' : ''}
                    </div>
                </div>
            `).join('');
        };
        
        window.addSlide = function() {
            if (!data.slides) data.slides = [];
            
            data.slides.push({
                title: "New Slide",
                content: "Your story here...",
                date: "",
                color: data.colors?.primary || "#0066ff",
                image: null
            });
            
            renderSlides();
            editSlide(data.slides.length - 1);
            showStatus('Slide added - edit and save');
        };
        
        window.editSlide = function(index) {
            editingIndex = index;
            const slide = data.slides[index];
            
            document.getElementById('editingNum').textContent = index + 1;
            document.getElementById('editSlideTitle').value = slide.title || '';
            document.getElementById('editSlideContent').value = slide.content || '';
            document.getElementById('editSlideDate').value = slide.date || '';
            document.getElementById('editSlideColor').value = slide.color || '#0066ff';
            
            const preview = document.getElementById('imagePreview');
            if (slide.image) {
                preview.src = slide.image;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
            
            document.getElementById('slideEditor').style.display = 'block';
        };
        
        window.saveSlide = function() {
            if (editingIndex === null || !data.slides[editingIndex]) return;
            
            data.slides[editingIndex].title = document.getElementById('editSlideTitle').value;
            data.slides[editingIndex].content = document.getElementById('editSlideContent').value;
            data.slides[editingIndex].date = document.getElementById('editSlideDate').value;
            data.slides[editingIndex].color = document.getElementById('editSlideColor').value;
            
            renderSlides();
            closeEditor();
            showStatus('Slide saved - click SAVE TO CLOUD to sync');
        };
        
        window.closeEditor = function() {
            document.getElementById('slideEditor').style.display = 'none';
            editingIndex = null;
        };
        
        window.deleteSlide = function() {
            if (editingIndex === null) return;
            if (!confirm('Delete this slide?')) return;
            
            data.slides.splice(editingIndex, 1);
            renderSlides();
            closeEditor();
            showStatus('Slide deleted - click SAVE TO CLOUD');
        };
        
        window.handleImage = function(input) {
            const file = input.files[0];
            if (!file) return;
            
            if (file.size > 500 * 1024) {
                alert('Image too large! Max 500KB. Use a smaller image or compress it first.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                if (editingIndex !== null && data.slides[editingIndex]) {
                    data.slides[editingIndex].image = e.target.result;
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                }
            };
            reader.readAsDataURL(file);
        };
        
        // Theme presets
        window.applyPreset = function(name) {
            const presets = {
                romantic: { primary: "#0066ff", secondary: "#ff0000", accent: "#ffd93d", bg: "#0a0a1a" },
                ocean: { primary: "#667eea", secondary: "#764ba2", accent: "#ffd93d", bg: "#0f0f23" },
                sunset: { primary: "#f093fb", secondary: "#f5576c", accent: "#ffd93d", bg: "#1a0f1f" },
                forest: { primary: "#11998e", secondary: "#38ef7d", accent: "#c4e538", bg: "#0a1f15" },
                gold: { primary: "#f5af19", secondary: "#f12711", accent: "#ffd700", bg: "#1f150a" },
                midnight: { primary: "#232526", secondary: "#414345", accent: "#7f8c8d", bg: "#000000" }
            };
            
            const p = presets[name];
            if (p) {
                document.getElementById('primaryColor').value = p.primary;
                document.getElementById('secondaryColor').value = p.secondary;
                document.getElementById('accentColor').value = p.accent;
                document.getElementById('bgColor').value = p.bg;
                showStatus('Theme applied - click SAVE TO CLOUD');
            }
        };
        
        function showStatus(msg, type = '') {
            const status = document.getElementById('status');
            status.textContent = msg;
            status.className = 'status ' + type;
        }
        
        // Start
        init();
    </script>
</body>
</html>
